package dz.ade.pfe.ouvrage.inventory.exploitation;

import dz.ade.pfe.domain.ouvrage.ExploitationReading;
import dz.ade.pfe.domain.ouvrage.WorkStopTimes;
import dz.ade.pfe.port.out.exploitation.deletetimes.DeleteTimes;
import dz.ade.pfe.port.out.exploitation.loadreading.LoadReadingDetails;
import dz.ade.pfe.port.out.exploitation.loadreadings.LoadOuvrageReadings;
import dz.ade.pfe.port.out.exploitation.savereading.SaveReading;
import dz.ade.pfe.port.out.exploitation.savereading.SaveWorkTime;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
@Component
@RequiredArgsConstructor
public class ExploitationPersistenceAdapter implements SaveWorkTime, SaveReading , LoadOuvrageReadings, LoadReadingDetails , DeleteTimes {
    private final ReadingRepository readingRepository;
    private final TimesRepository timesRepository;
    @Override
    public ExploitationReading saveReading(ExploitationReading reading) {

        return readingRepository.save(reading);
    }

    @Override
    public List<WorkStopTimes> saveWorkStopTime(List<WorkStopTimes> times) {
        return timesRepository.saveAll(times);
    }

    @Override
    public List<ExploitationReading> loadOuvrageReadings(String code) {
        return readingRepository.getByOuvrageCode(code);
    }

    @Override
    public ExploitationReading loadReading(String code, String id) {
        return readingRepository.getByIdAndOuvrageCode( Long.parseLong(id),  code);
    }

    @Override
    public List<WorkStopTimes> loadWorkStops(String id) {
        return timesRepository.getByReadingId(Long.parseLong(id));
    }

    @Transactional
    @Override
    public void deleteTimes(List<Long> ids) {
        timesRepository.deleteByIdIn(ids);
    }
}
