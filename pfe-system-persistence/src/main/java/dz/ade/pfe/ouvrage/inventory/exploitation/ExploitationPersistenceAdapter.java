package dz.ade.pfe.ouvrage.inventory.exploitation;

import dz.ade.pfe.domain.ouvrage.CycleOuvrage;
import dz.ade.pfe.domain.ouvrage.ExploitationReading;
import dz.ade.pfe.domain.ouvrage.WorkStopTimes;
import dz.ade.pfe.port.out.exploitation.availability.LoadAvailability;
import dz.ade.pfe.port.out.exploitation.checkreading.CheckReading;
import dz.ade.pfe.port.out.exploitation.deletepersonnel.DeletePersonnelByIds;
import dz.ade.pfe.port.out.exploitation.deletetimes.DeleteTimes;
import dz.ade.pfe.port.out.exploitation.loadreading.LoadReadingDetails;
import dz.ade.pfe.port.out.exploitation.loadreadings.LoadOuvrageReadings;
import dz.ade.pfe.port.out.exploitation.readingnumbers.ReadingNumbers;
import dz.ade.pfe.port.out.exploitation.savereading.SaveReading;
import dz.ade.pfe.port.out.exploitation.savereading.SaveWorkTime;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

@Component
@RequiredArgsConstructor
public class ExploitationPersistenceAdapter implements CheckReading,SaveWorkTime, SaveReading , DeletePersonnelByIds, LoadOuvrageReadings, LoadReadingDetails , DeleteTimes, ReadingNumbers, LoadAvailability {
    private final ReadingRepository readingRepository;
    private final TimesRepository timesRepository;
    private final ExploitationUserRepository exploitationUserRepository;
    private final CycleRepository cycleRepository;
    @Override
    public ExploitationReading saveReading(ExploitationReading reading) {

        return readingRepository.save(reading);
    }

    @Override
    public List<WorkStopTimes> saveWorkStopTime(List<WorkStopTimes> times) {
        return timesRepository.saveAll(times);
    }

    @Override
    public List<ExploitationReading> loadOuvrageReadings(String code) {
        return readingRepository.getByOuvrageCode(code);
    }

    @Override
    public List<CycleOuvrage> loadOuvragecCycles(String code) {
        return cycleRepository.getByOuvrageCode(code);
    }

    @Override
    public ExploitationReading loadReading(String code, String id) {
        return readingRepository.getByIdAndOuvrageCode( Long.parseLong(id),  code);
    }

    @Override
    public List<WorkStopTimes> loadWorkStops(String id) {
        return timesRepository.getByReadingId(Long.parseLong(id));
    }

    @Transactional
    @Override
    public void deleteTimes(List<Long> ids) {
        timesRepository.deleteByIdIn(ids);
    }

    @Override
    public List<Object> LoadReadingNumbers() {
        Object obj = readingRepository.ReadingAllNombre();
        List<Object> list =  readingRepository.ReadingNombre();
        list.add(obj);
        return list;
    }

    @Override
    public Object loadAvailability() {
        return readingRepository.loadAvailability();
    }

    @Override
    public List<Object> loadAvailabilityDays() {
        return readingRepository.loadAvailabilityDays();
    }

    @Override
    public Object loadSNCUse() {
        return readingRepository.loadSNCUse();
    }

    @Override
    public void deletePersonnelByIds(List<Long> ids) {
        exploitationUserRepository.deleteByIdIn(ids);
    }

    @Override
    public Optional<ExploitationReading> exist(LocalDate date, String code) {
        return readingRepository.exist(date,code);
    }
}
